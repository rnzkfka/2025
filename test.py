import streamlit as st
from colorsys import rgb_to_hls

# -----------------------------
# 데이터 (이전과 동일)
# -----------------------------
universities = {
    "서울특별시": ["서울대학교", "연세대학교", "고려대학교", "한양대학교", "성균관대학교"],
    "광주광역시": ["전남대학교", "조선대학교", "광주과학기술원"],
    "부산광역시": ["부산대학교", "동아대학교", "부경대학교", "부산가톨릭대학교", "신라대학교"],
    "대구광역시": ["경북대학교", "계명대학교", "대구가톨릭대학교", "영남대학교", "경일대학교"],
    "인천광역시": ["인하대학교", "경인교육대학교", "인천대학교", "인천가톨릭대학교"],
    "대전광역시": ["충남대학교", "한남대학교", "목원대학교", "배재대학교"],
    "울산광역시": ["울산대학교", "을지대학교", "울산과학대학교"],
    "경기도": ["성균관대학교(수원)", "경기대학교", "한양대학교(ERICA)", "수원대학교", "가천대학교"],
    "강원도": ["강원대학교", "한라대학교", "강릉원주대학교", "강릉영동대학교"],
    "충청북도": ["충북대학교", "청주대학교", "서원대학교", "건국대학교(충주캠)"],
    "충청남도": ["공주대학교", "순천향대학교", "한국기술교육대학교", "호서대학교", "청운대학교"],
    "전라북도": ["전북대학교", "원광대학교", "우석대학교", "군산대학교", "전주대학교"],
    "전라남도": ["목포대학교", "순천대학교", "전남대학교", "조선대학교", "광주과학기술원"],
    "경상북도": ["경북대학교", "포항공과대학교", "영남대학교", "안동대학교", "대구가톨릭대학교"],
    "경상남도": ["경상대학교", "창원대학교", "부경대학교", "인제대학교", "마산대학교"],
    "제주도": ["제주대학교"],
}

departments = {
    "서울대학교": ["컴퓨터공학과", "경제학과", "물리학과", "경영학과", "법학과"],
    "연세대학교": ["컴퓨터과학과", "전자공학과", "경영학과", "국문학과", "심리학과"],
    "고려대학교": ["컴퓨터학과", "법학과", "경영학과", "의예과", "정치외교학과"],
    "한양대학교": ["기계공학과", "컴퓨터공학과", "경영학과", "화학과", "건축학과"],
    "성균관대학교": ["소프트웨어학과", "경영학과", "전자공학과", "화학과", "심리학과"],
    "전남대학교": ["컴퓨터공학과", "농업경제학과", "간호학과", "기계공학과", "화학과"],
    "조선대학교": ["컴퓨터공학과", "건축학과", "경영학과", "법학과", "화학과"],
    "광주과학기술원": ["전기공학과", "기계공학과", "컴퓨터공학과", "화학공학과", "물리학과"],
    "부산대학교": ["컴퓨터공학과", "전자공학과", "경영학과", "법학과", "심리학과"],
    "부경대학교": ["해양학과", "컴퓨터공학과", "경영학과", "전자공학과", "생명과학과"],
    "부산가톨릭대학교": ["간호학과", "유아교육과", "사회복지학과"],
    "신라대학교": ["관광학과", "경영학과", "컴퓨터공학과"],
    "제주대학교": ["관광학과", "해양학과", "축산학과", "간호학과"],
}

dept_emojis = {
    "컴퓨터공학과": "💻",
    "소프트웨어학과": "💻",
    "전자공학과": "🔌",
    "기계공학과": "⚙️",
    "화학과": "⚗️",
    "화학공학과": "⚗️",
    "경제학과": "💰",
    "경영학과": "📊",
    "법학과": "⚖️",
    "간호학과": "🩺",
    "국문학과": "📖",
    "심리학과": "🧠",
    "건축학과": "🏛️",
    "전기공학과": "💡",
    "물리학과": "🔬",
    "해양학과": "🌊",
    "생명과학과": "🧬",
    "유아교육과": "🧸",
    "사회복지학과": "🤝",
    "관광학과": "🌴",
    "축산학과": "🐄",
    "의예과": "⚕️",
    "정치외교학과": "🗳️",
    "약학과": "💊",
    "보건학과": "🩹",
    "교육학과": "📚",
    "특수교육과": "📝",
}

uni_colors = {
    "서울대학교": "#003366",
    "연세대학교": "#003399",
    "고려대학교": "#990000",
    "한양대학교": "#FF6600",
    "성균관대학교": "#0033CC",
    "전남대학교": "#006633",
    "조선대학교": "#CC0033",
    "광주과학기술원": "#FFCC00",
    "부산대학교": "#003366",
    "부경대학교": "#006699",
    "부산가톨릭대학교": "#990000",
    "신라대학교": "#FF6600",
    "제주대학교": "#339966",
}

# -----------------------------
# 폰트 & 타이틀
# -----------------------------
st.markdown(
    """
    <style>
    html, body, [class*="css"]  {
        font-family: 'Malgun Gothic', 'Arial', sans-serif;
    }
    </style>
    """,
    unsafe_allow_html=True
)

st.title("전국 대학교와 학과")

# -----------------------------
# 지역 선택
# -----------------------------
selected_region = st.selectbox("지역을 선택하세요", sorted(universities.keys()))

if selected_region:
    st.subheader(f"{selected_region}의 대학교")
    selected_uni = st.selectbox("대학교를 선택하세요", universities[selected_region][:5])

    if selected_uni:
        # 배경색 변경
        color = uni_colors.get(selected_uni, "#FFFFFF")
        st.markdown(
            f"""
            <style>
            .stApp {{
                background-color: {color};
            }}
            </style>
            """,
            unsafe_allow_html=True
        )

        st.subheader(f"{selected_uni}의 학과")

        # 학과 출력 - 카드 형태 + 색 대비 적용
        dept_list = departments.get(selected_uni, [])
        for dept in dept_list[:5]:
            emoji = dept_emojis.get(dept, "🏫")

            # 배경 대비에 따른 글자색
            r = int(color[1:3],16)/255
            g = int(color[3:5],16)/255
            b = int(color[5:7],16)/255
            h,l,s = rgb_to_hls(r,g,b)
            text_color = "#000000" if l > 0.6 else "#FFFFFF"

            st.markdown(
                f"""
                <div style="
                    background-color: rgba(255,255,255,0.2);
                    color: {text_color};
                    padding: 10px;
                    margin: 5px 0px;
                    border-radius: 10px;
                    font-size: 18px;
                    font-weight: bold;
                    box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
                ">
                    {emoji} {dept}
                </div>
                """,
                unsafe_allow_html=True
            )

# 배경색이 어두운 경우 글자색 자동 변경
# RGB → HLS로 변환하여 밝기(L) 확인
r = int(color[1:3], 16) / 255
g = int(color[3:5], 16) / 255
b = int(color[5:7], 16) / 255
h, l, s = rgb_to_hls(r, g, b)

# 밝기가 낮으면 글자색 흰색
text_color = "#FFFFFF" if l < 0.5 else "#000000"

st.markdown(
    f"""
    <style>
    .stApp .css-1d391kg {{ color: {text_color}; }}   /* 타이틀 */
    .stApp .css-1v3fvcr {{ color: {text_color}; }}   /* 서브헤더 */
    .stApp .st-bx {{ color: {text_color}; }}         /* 선택박스 */
    </style>
    """,
    unsafe_allow_html=True
)
